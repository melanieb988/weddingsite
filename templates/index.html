{% extends 'layout.html' %}

{% block body %}
<div class="page-wrapper">

  <div class="page-grid">

    <!-- LEFT: COLLAGE -->
    <div class="collage-wrapper four-img">
      <!-- Images injected dynamically via JS -->
    </div>

    <!-- RIGHT: INVITATION CONTENT -->
    <div class="invitation-content">
      <p class="save-the-date">
        Save the Date
        
      </p>

      <h1 class="names">
        Melanie Bowden<br>
        <span class="ampersand">&amp;</span><br>
        Isaac Birocci
      </h1>
      <span class="logo-inline">
        <img src="{{ url_for('static', filename='images/biltmore1.png') }}" alt="Venue logo">
      </span>
      <p class="date">October 24, 2026</p>
      <p class="location">Atlanta, Georgia</p>

      <button class="rsvp-btn" data-bs-toggle="modal" data-bs-target="#rsvpModal">
        RSVP
      </button>
    </div>

  </div>
</div>

<!-- RSVP MODAL -->
<div class="modal fade" id="rsvpModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-scrollable">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">RSVP</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <input type="text" id="guestName" class="form-control mb-3" placeholder="Enter your name">
        <button id="searchBtn" class="btn btn-outline-dark mb-3">Find My Invitation</button>
        <div id="householdContainer"></div>
      </div>

      <div class="modal-footer">
        <button id="submitRsvpBtn" class="btn btn-dark">Too soon to RSVP! </button>
      </div>
    </div>
  </div>
</div>
<style>
    /* ========================= */
    /* BASE RESET */
    /* ========================= */
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      /* height: 100%; */
      background: #faf9f7;
      font-family: 'Montserrat', sans-serif;
    }
    
    .page-wrapper {
      width: 100vw;
      /* height: 100vh; */
    }
    
    .page-grid {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      width: 100%;
      /* height: 100%; */
    }
    
    /* ========================= */
    /* COLLAGE SYSTEM */
    /* ========================= */
    .collage-wrapper {
      position: relative;
      width: 100%;
      aspect-ratio: 4 / 3; /* overridden per rotation */
      overflow: hidden;
      background: #faf9f7;
      max-height:65vh;
    }
    
    /* All images fill their boxes */
    .collage-photo {
      position: absolute;
      width: 100%;
      height: 100%;
      object-fit: cover;
    
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    
      transition:
        top 0.6s ease,
        left 0.6s ease,
        width 0.6s ease,
        height 0.6s ease,
        transform 0.6s ease,
        opacity 0.6s ease;
    }
    
    /* ========================= */
    /* INVITATION CONTENT */
    /* ========================= */
    .invitation-content {
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: center;
      padding: 16px;
      text-align: center;
      margin-top: 10px;
    }
    
    .save-the-date {
      font-family: 'Great Vibes', cursive;
      font-size: 4rem;
      color: #2d2f3f;
    }
    
    .logo-inline img {
      height: 74px;
      margin: 0 15px 16px;
      vertical-align: middle;
      opacity: 0.8;
    }
    
    .names {
      font-family: serif;
      font-size: 3rem;
      color: #514131;
      line-height: 1.1;
      margin-bottom: 16px;
    }
    
    .ampersand {
      color: #8a685d;
      font-size: 2.2rem;
    }
    
    .date {
      font-family: 'Montserrat', sans-serif;
      letter-spacing: 0.18em;
      color: #514131;
      margin-bottom: 4px;
    }
    
    .location {
      font-family: 'Montserrat', sans-serif;
      color: #2d2f3f;
      margin-bottom: 24px;
    }
    
    .rsvp-btn {
      background: transparent;
      border: 1px solid #514131;
      color: #514131;
      padding: 12px 36px;
      letter-spacing: 0.14em;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .rsvp-btn:hover {
      background: #514131;
      color: #faf9f7;
    }
    
    /* ========================= */
    /* MOBILE */
    /* ========================= */
    @media (max-width: 768px) {
      html, body {
        height: auto;
      }
    
      .page-grid {
        grid-template-columns: 1fr;
        height: auto;
      }
    
      .collage-wrapper {
        width: 100%;
      }
    
      .collage-photo {
        border-radius: 10px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.14);
      }
    }
    </style>
    
<!-- ---------------------- -->
<!-- ROTATING COLLAGE JS -->
<!-- ---------------------- -->
<script>
    const wrapper = document.querySelector('.collage-wrapper');
    let current = 0;
  
    const isMobile = () => window.innerWidth <= 768;
  
    /* ========================= */
    /* DESKTOP ROTATIONS */
    /* ========================= */
    const DESKTOP_ROTATIONS = [
      {
        aspectRatio: '4 / 3',
        images: [
          'yellowstone.JPG',
          'liftsnow.jpg',
          'banff.jpg',
          'parents.jpg'
        ],
        layout: [
          { top: 0,  left: 0,  width: 50, height: 50 },
          { top: 0,  left: 50, width: 50, height: 50 },
          { top: 50, left: 0,  width: 50, height: 50 },
          { top: 50, left: 50, width: 50, height: 50 }
        ],
        rotate: [-2, 2]
      },
      {
        aspectRatio: '3 / 4',
        images: [
          'guatamaladock.jpg',
          'rafting.jpeg',
          'party.jpg'
        ],
        layout: [
          { top: 0,  left: 0,  width: 40, height: 100 },
          { top: 0,  left: 40, width: 60, height: 50 },
          { top: 50, left: 40, width: 60, height: 50 }
        ],
        rotate: [-1.5, 1.5]
      },
      {
        aspectRatio: '3 / 4',
        images: [
          'dipsea.jpg',
          'ski.jpg',
          'hbike.JPG'
        ],
        layout: [
          { top: 0,  left: 60, width: 40, height: 100 },
          { top: 0,  left: 0,  width: 60, height: 50 },
          { top: 50, left: 0,  width: 60, height: 50 }
        ],
        rotate: [-1.5, 1.5]
      }
    ];
  
    /* ========================= */
    /* MOBILE ROTATIONS */
    /* ========================= */
    const MOBILE_ROTATIONS = [
      {
        aspectRatio: '1 / 1',
        images: [
        'banff.jpg',
        
          'liftsnow.jpg',
          'grun.jpg',
          'parents.jpg'
        ],
        layout: [
          { top: 0,  left: 0,  width: 50, height: 65 },
          { top: 0,  left: 50, width: 50, height: 50 },
          { top: 62, left: 0,  width: 50, height: 40 },
          { top: 50, left: 50, width: 50, height: 50 }
        ],
        rotate: [-1, 1]
      },
      {
        aspectRatio: '4 / 5',
        images: [
          'dipsea.jpg',
          'ski.jpg',
          'guatamalastreet.JPG'
        ],
        layout: [
          { top: 0,  left: 45, width: 55, height: 100 },
          { top: 0,  left: 0,  width: 46, height: 50 },
          { top: 50, left: 0,  width: 46, height: 50 }
        ],
        rotate: [-1, 1]
      },
      {
        aspectRatio: '4 / 5',
        images: [
          'colluseum.JPG',
          'party.jpg',
          'bike.JPG'
          
          
        ],
        layout: [
          { top: 0,  left: 45, width: 55, height: 100 },
          { top: 0,  left: 0,  width: 55, height: 50 },
          { top: 50, left: 0,  width: 46, height: 50 }
        ],
        rotate: [-1, 1]
      },
      
      {
        aspectRatio: '4 / 5',
        images: [
          'banffrun.jpg',
          'ggp.JPG',
          'proposal.jpg'
          
        ],
        layout: [
          { top: 0,  left: 0, width: 55, height: 100 },
          { top: 0,  left: 50,  width: 55, height: 50 },
          { top: 50, left: 50,  width: 50, height: 50 }
        ],
        rotate: [-1, 1]
      },    {
        aspectRatio: '4 / 5',
        images: [
          'guatamaladock.jpg',
          'trun.JPG',
          'brun.heic'
        ],
        layout: [
          { top: 0,  left: 45, width: 55, height: 100 },
          { top: 0,  left: 0,  width: 55, height: 50 },
          { top: 48, left: 0,  width: 46, height: 55 }
        ],
        rotate: [-1, 1]
      },
      {
        aspectRatio: '1 / 1',
        images: [
        'bballgame.jpeg',
        
          'hbike.jpg',
          'italybike.jpeg',
          'yellowstone.JPG'
        ],
        layout: [
          { top: 0,  left: 0,  width: 50, height: 60 },
          { top: 0,  left: 50, width: 50, height: 50 },
          { top: 60, left: 0,  width: 50, height: 40 },
          { top: 50, left: 50, width: 50, height: 50 }
        ],
        rotate: [-1, 1]
      },
    ];
  
    /* ========================= */
    /* RENDER */
    /* ========================= */
    function renderRotation() {
      const rotations = isMobile() ? MOBILE_ROTATIONS : DESKTOP_ROTATIONS;
      const rotation = rotations[current % rotations.length];
  
      wrapper.innerHTML = '';
      wrapper.style.aspectRatio = rotation.aspectRatio;
  
      rotation.images.forEach((src, i) => {
        const img = document.createElement('img');
        img.src = `/static/images/collage/${src}`;
        img.className = 'collage-photo';
  
        const { top, left, width, height } = rotation.layout[i];
        img.style.top = `${top}%`;
        img.style.left = `${left}%`;
        img.style.width = `${width}%`;
        img.style.height = `${height}%`;
  
        const [minR, maxR] = rotation.rotate;
        const angle = minR + Math.random() * (maxR - minR);
        img.style.transform = `rotate(${angle}deg)`;
  
        wrapper.appendChild(img);
      });
    }
  
    /* ========================= */
    /* INIT */
    /* ========================= */
    renderRotation();
  
    /* ========================= */
    /* ROTATE */
    /* ========================= */
    setInterval(() => {
      current++;
      renderRotation();
    }, 4000);
  
    /* ========================= */
    /* RESIZE */
    /* ========================= */
    window.addEventListener('resize', () => {
      current = 0; // optional: reset to avoid weird jumps
      renderRotation();
    });
  </script>
  
    
  <script>
    const container = document.getElementById("householdContainer");
    
    /* SEARCH BUTTON */
    document.getElementById("searchBtn").addEventListener("click", async () => {
        const name = document.getElementById("guestName").value.trim();
        if (!name) return alert("Please enter your name.");
    
        container.innerHTML = "<p>Searching...</p>";
    
        const res = await fetch("/api/lookup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name })
        });
    
        const matches = await res.json();
        container.innerHTML = "";
    
        if (!matches.length) {
            container.innerHTML = "<p>No invitation found. Please check spelling.</p>";
            return;
        }
    
        // Single match → load household
        if (matches.length === 1) {
            loadHousehold(matches[0]);
            return;
        }
    
        // Multiple matches → user selects which one they are
        container.innerHTML = "<p class='fw-bold'>Multiple matches found. Which one are you?</p>";
        matches.forEach(m => {
            const btn = document.createElement("button");
            btn.className = "btn btn-outline-primary w-100 mb-2";
            btn.innerText = `${m.name} (${m.household_id})`;
            btn.onclick = () => loadHousehold(m);
            container.appendChild(btn);
        });
    });
    
    /* LOAD HOUSEHOLD MEMBERS */
    async function loadHousehold(selectedPerson) {
        container.innerHTML = "<p>Loading your household...</p>";
    
        const res = await fetch("/api/household", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ household_id: selectedPerson.household_id })
        });
    
        const guests = await res.json();
        renderHousehold(guests);
    }
    
    /* RENDER HOUSEHOLD FORM */
    function renderHousehold(guests) {
        container.innerHTML = "";
    
        guests.forEach(g => {
            const div = document.createElement("div");
            div.className = "border rounded p-3 mb-3";
    
            const plusOneHTML = g.plus_one_allowed ? `
                <label class="form-label mt-2">Bringing a plus one?</label>
                <select class="form-select plus-one-toggle">
                    <option value="no" ${!g.plus_one_name ? "selected" : ""}>No</option>
                    <option value="yes" ${g.plus_one_name ? "selected" : ""}>Yes</option>
                </select>
                <input class="form-control mt-2 plus-one-name"
                       placeholder="Plus One Name"
                       value="${g.plus_one_name || ""}"
                       style="display:${g.plus_one_name ? "block" : "none"}">
            ` : "";
    
            div.innerHTML = `
                <div class="form-check">
                    <input class="form-check-input attending" type="checkbox" ${g.attending ? "checked" : ""}>
                    <label class="form-check-label fw-bold">${g.name}</label>
                </div>
    
                <input class="form-control mt-2 meal"
                       placeholder="Meal choice"
                       value="${g.meal_choice || ""}">
    
                ${plusOneHTML}
    
                <input class="form-control mt-2 song"
                       placeholder="Song request"
                       value="${g.song_rec || ""}">
            `;
    
            container.appendChild(div);
        });
    }
    
    /* TOGGLE PLUS ONE NAME FIELD */
    document.addEventListener("change", e => {
        if (e.target.classList.contains("plus-one-toggle")) {
            const input = e.target.nextElementSibling;
            if (e.target.value === "yes") {
                input.style.display = "block";
            } else {
                input.style.display = "none";
                input.value = "";
            }
        }
    });
    
    /* SUBMIT RSVP */
 /* ========================= */
/* SUBMIT RSVP (COMING SOON) */
/* ========================= */
document.getElementById("submitRsvpBtn").addEventListener("click", () => {
    const cards = document.querySelectorAll("#householdContainer > div");
    
    if (!cards.length) {
        alert("Please search for your invitation first.");
        return;
    }

    // Collect guest info (optional for future use)
    const guests = Array.from(cards).map(card => ({
        name: card.querySelector(".form-check-label").innerText,
        attending: card.querySelector(".attending").checked,
        meal_choice: card.querySelector(".meal").value,
        plus_one_name: card.querySelector(".plus-one-name")
            ? card.querySelector(".plus-one-name").value
            : null,
        song_rec: card.querySelector(".song").value
    }));

    // For now, just show coming soon
    alert("RSVP coming soon! Thank you for checking your invitation.");
});

    </script>
{% endblock %}




