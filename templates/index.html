{% extends 'layout.html' %}

{% block body %}
<div class="container my-5">
    <div class="row align-items-start">
        <!-- Collage Section -->
        <div class="col-md-5 mb-4 mb-md-0 position-relative">
            <div class="collage">
                <img src="{{ url_for('static', filename='images/liftsnow.jpg') }}" class="collage-photo photo1" alt="Photo 1">
                <img src="{{ url_for('static', filename='images/photo2.jpg') }}" class="collage-photo photo2" alt="Photo 2">
                <img src="{{ url_for('static', filename='images/photo3.jpg') }}" class="collage-photo photo3" alt="Photo 3">
            </div>
        </div>

        <!-- Wedding Info Section -->
        <div class="col-md-7">
            <h1 class="display-4 text-primary">We're Getting Married!</h1>
            <p class="lead">Join us for our special day on <strong>October 24, 2026</strong> at <strong>Sunset Gardens</strong>.</p>
            <p>Ceremony starts at 4 PM, followed by dinner and dancing.</p>
            <p>Please RSVP by <strong>May 24, 2026</strong>.</p>

            <!-- RSVP Button -->
            <button id="rsvpBtn" class="btn btn-success btn-lg mt-3">RSVP</button>

            <!-- Typeform Iframe (hidden initially) -->
          <div id="rsvpForm" class="mt-4" style="display:none;">
    <div data-tf-live="01KGNB2KYPBK5T3Q6DVEDM4S6D"></div>
    <script src="//embed.typeform.com/next/embed.js"></script>
</div>
        </div>
    </div>
</div>

<style>
/* Collage styles */
.collage {
    position: relative;
    width: 100%;
    max-width: 400px;
    margin: auto;
}

.collage-photo {
    width: 100%;
    border-radius: 12px;
    box-shadow: 0 8px 15px rgba(0,0,0,0.15);
    position: absolute;
    transition: transform 0.3s;
}

/* Angled collage positions */
.photo1 { transform: rotate(-8deg); top: 0; left: 0; z-index: 3; }
.photo2 { transform: rotate(5deg); top: 20px; left: 20px; z-index: 2; }
.photo3 { transform: rotate(-5deg); top: 40px; left: -10px; z-index: 1; }

/* Responsive adjustments */
@media (max-width: 768px) {
    .collage {
        position: relative;
        max-width: 90%;
        height: auto;
    }

    .collage-photo {
        position: relative;
        transform: rotate(0deg) !important;
        margin-bottom: 15px;
    }

    /* Stack RSVP form below images on mobile */
    #rsvpForm {
        margin-top: 20px;
    }
}
</style>

<script src="//embed.typeform.com/next/embed.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function() {
    const btn = document.getElementById("rsvpBtn");
    const formContainer = document.getElementById("rsvpForm");

    btn.addEventListener("click", function() {
        formContainer.style.display = "block";
        btn.scrollIntoView({ behavior: "smooth", block: "start" });

        // Listen for Typeform ready event
        if (!window.typeformListenerAdded) {
            // Typeform automatically triggers tf.load when data-tf-live is used
            window.tf.load = window.tf.load || [];
            window.tf.load.push(function() {
                const iframe = formContainer.querySelector("iframe");

                if (iframe) {
                    // Listen for messages from the Typeform iframe
                    window.addEventListener("message", function(event) {
                        // Make sure message is from Typeform
                        if (event.origin.includes("typeform.com") && event.data === "form-submit") {
                            // Hide the form when submitted
                            formContainer.style.display = "none";
                            alert("Thank you for your RSVP!");
                        }
                    });
                }
            });

            window.typeformListenerAdded = true;
        }
    });
});
</script>
{% endblock %}
